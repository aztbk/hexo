---
abbrlink: ''
categories:
- - 搭建教程
cover: https://picgo91.cdn456.eu.org/20250818133308778.png
date: '2025-08-15'
layout: post
message: 欢迎来到我的博客，请输入密码以阅读。
password: Mignon999
tags:
- 域名转发
title: 域名转发授权管理系统的搭建教程
top_img: https://picgo91.cdn456.eu.org/20250815163346066.png
updated: '2025-11-27T13:52:43.388+08:00'
wrong_pass_message: 密码错误请重新输入
---
# 域名转发授权管理系统的搭建教程

## 1.安装授权系统

1、上传文件到`/www/wwwroot/`目录下进行解压

2、添加数据库【菜单：**数据库**->**添加数据库**】

⑴．创建数据库，数据库名称为:

```
gfw_grant
```

⑵将上面的用户名和密码信息，填写到`/www/wwwroot/GfwGrant/GfwGrant/config.ini`配置文件中的**user**和**password**字段

![](https://picgo91.cdn456.eu.org/20250815163346066.png)

### 2.创建Python项目【菜单：网站->Python项目】

⑴、在Python版本管理中，选择安装**python3.6.x**，若提示参数设置直接确定

⑵、添加**Python项目**，如下

1）启动命令：

```
python3 manage.py runserver 127.0.0.1:8000
```

![](https://picgo91.cdn456.eu.org/20250815163920676.png)

> **注意：若修改了数据库帐号密码，需要重启项目服务**

### 3、添加反向代理【菜单：网站->反向代理】

1. 目标地址为
   ```
   http://127.0.0.1:8000
   ```

![](https://picgo91.cdn456.eu.org/20250815165022571.png)

2. 添加成功后，在**Python项目**中打开**终端**，运行命令。![](https://picgo91.cdn456.eu.org/20250815165616990.png)

   ```
   python3 manage.py migrate && python3 manage.py createsuperuser
   ```
3. 配置Nginx，将其申请证书![](https://picgo91.cdn456.eu.org/20250815165358659.png)
4. 访问**https://授权域名/admin**，查看能否正常打开，若能正常打开，即安装成功

### 4、部署下载服务

1．上传Gfw.tar.gz文件包到`/www/wwwroot/`目录 进行解压

2．创建HTML项目，如下

域名：**你的下载域名**

备注：

根目录：**/www/wwwroot/mike**

FTP：不创建

![](https://picgo91.cdn456.eu.org/20250815170623005.png)

> **注意：下载域名不需要开启证书**

### 主控安装：

#### 下载文件：

```
yum install wget -y && wget http://down.cdn456.eu.org/gfw/gfw-newer-https/setup_backend --no-check-certificate -O setup
```

#### 运行安装：

```
setenforce 0; chmod +x setup && ./setup
```

### 节点安装：

#### 下载文件：

```
yum install wget -y && wget http://down.cdn456.eu.org/gfw/gfw-newer-https/setup_forward --no-check-certificate -O setup
```

#### 运行安装：

```
setenforce 0; chmod +x setup && ./setup
```

#### 节点空间处理

```
du -sh /tmp
```

清空超过1G的日志文件

```
find / -type f -size +1G -name "*.log"|xargs truncate -s 0
```

#### 当出现安装完IP的443端口正常，域名解析上去443不通的时候是机器yum源有问题，导致依赖程序redis没有安装上。

解决办法，手动安装
1、先运行命令 

```
yum localinstall  http://down.cdn456.eu.org/gfw/sys/redis-3.2.12-2.el7.x86_64.rpm  http://down.cdn456.eu.org/gfw/sys/jemalloc-3.6.0-1.el7.x86_64.rpm -y
```

2、然后再重新运行安装命令即可（不用再配置）

```
setenforce 0; chmod +x setup && ./setup
```

---

## 授权调用

我怎么调用下面api进行授权

接口： 

```
http://gyd.5205230.xyz/grant/200/?type=11
```

```
http://gyd.5205230.xyz/grant/301/?type=11
```

```
授权成功显示：
{
"code": 0,
"success": true,
"message": ""
}
未授权显示：
{
"code": 10,
"success": false,
"message": "IP(117.30.197.188) 未授权"
}
停止授权显示：
{
"code": 10,
"success": false,
"message": "IP(117.30.197.188) 已停止授权"
}
```

## 301转发更换中间域名方法

### 主控：

#### 开通端口：

TCP：46378 46379 111 3600 22 25 8899 

UDP：737 68 111 323

#### 运行：

```
setenforce 0; chmod +x setup && ./setup
```

```
[root@VM-TYO1-RX9AA62WS9 ~]# setenforce 0; chmod +x setup && ./setup
setenforce: SELinux is disabled
开始执行 验证授权
结束执行 验证授权 【成功】
配置文件已存在！是否重写配置文件？[Yes/No] Default:No  yes
请先填写转发的相关信息
其中包括：域名、转发端口、管理端口、是否启用https
【以上配置需要与转发程序信息相一致】
主机域名，多个以,分隔: htcdnnew.bbin888865620.com,mngot.anmnnoe1.com
转发端口: 3600
管理端口: 8899
```

到时候看你要先设置几个域名就填几个域名，中间用“,"隔开。

这边就按照指添加一个`mngot.anmnnoe1.com`

接下去安装的时候加入的证书为：`htcdnnew.bbin888865620.com`这个的证书。

#### 修改nginx.conf

##### 文件地址：

修改配置文件`etc/nginx/nginx.conf`大约在40行

```
sudo vim /etc/nginx/nginx.conf
```

```
    # redirect port
    server {
        listen       3600 ssl;
        server_name  mngot.anmnnoe1.com;

        ssl_certificate      fullchain.crt;
        ssl_certificate_key  private.key;

        ssl_session_cache    shared:SSL:1m;
        ssl_session_timeout  5m;

        ssl_ciphers  HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers  on;

        root   /opt/gfw/backend/;

        location = / {
               proxy_pass http://backend;
               proxy_set_header Host $host:$server_port;
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
         }
    }
```

保存后退出。

##### 检测是否正确

```
sudo nginx -t
```

##### 重新加载配置

```
sudo nginx -s reload
```

##### 拷贝证书：

证书名字一定是：`private.key`和`fullchain.crt`

存放地址：`/etc/nginx/`

### 节点

#### 开通端口：

TCP：443 80 8989 111 22

UDP：68 111 792

#### 运行：

```
setenforce 0; chmod +x setup && ./setup
```

重新安装，把中间域名改成你的中间域名。
